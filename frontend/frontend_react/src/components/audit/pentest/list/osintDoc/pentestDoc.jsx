import React, {useEffect, useState} from 'react';
import {useParams} from 'react-router-dom';
import instance from "../../../../../store/api";
import html2canvas from "html2canvas";
import jsPDF from "jspdf";
import {Trans} from "react-i18next";


const PentestDoc = () => {
    const {id} = useParams();
    const [pentestData, setpentestData] = useState({})

    const downloadPDF = (id) => {
        const capture = document.querySelector(`#actual-receipt${pentestData.id}`);
        html2canvas(capture).then((canvas) => {
            const imgData = canvas.toDataURL('img/png');
            const doc = new jsPDF('p', 'mm', 'a4');
            const componentWidth = doc.internal.pageSize.getWidth();
            const componentHeight = doc.internal.pageSize.getHeight();
            doc.addImage(imgData, 'PNG', 0, 10, componentWidth, componentHeight );
            doc.save('receipt.pdf');
        })
    }

    useEffect(function () {
        UrlHandler()
    }, [])

    function UrlHandler() {


        instance.get('http://localhost:8000/api/pentesting/pentesting/' + id + "/")
            .then(res => {
                setpentestData(res.data);
            })

    }

    return (
        <div className={"continer_project company-container"}>
            <div id={`actual-receipt${pentestData.id}`}>
                <h1 className={"project_h1"}>Результаты пентеста:</h1>
                <p><b>ID:</b> {pentestData && pentestData.id}</p>
                <p><b>Название организации:</b> {pentestData && pentestData.organizationName}</p>
                <p><b>Имя лица:</b> {pentestData && pentestData.personName}</p>
                <p><b>Цели и задачи:</b> {pentestData && pentestData.goalsAndTasks}</p>
                <p><b>Сбор данных:</b> {pentestData && pentestData.dataCollection}</p>
                <p><b>Фильтрация и анализ данных:</b> {pentestData && pentestData.dataFilteringAndAnalysis}</p>
                <p><b>Хранение данных:</b> {pentestData && pentestData.dataStorage}</p>
                <p><b>URL:</b> {pentestData && pentestData.url}</p>

                <div>
                    <h1 className={"project_h1"}>PTES:</h1>
                    <h2 className={"project_h2"}>Аудит Инициации</h2>
                    <p><b>ID:</b> {pentestData && pentestData.PTES_AuditInitiation && pentestData.PTES_AuditInitiation.id}</p>
                    <p><b>Аудитные
                        цели:</b> {pentestData.PTES_AuditInitiation && pentestData.PTES_AuditInitiation.audit_objectives}</p>
                    <p><b>Методология и
                        инструменты:</b> {pentestData.PTES_AuditInitiation && pentestData.PTES_AuditInitiation.methodology_and_tools}</p>
                    <p><b>Аудитное
                        расписание:</b> {pentestData.PTES_AuditInitiation && pentestData.PTES_AuditInitiation.audit_schedule}</p>


                    <h2 className={"project_h2"}>Информационное собирание</h2>
                    <p><b>ID:</b> {pentestData && pentestData.PTES_InformationGathering && pentestData.PTES_InformationGathering.id}</p>
                    <p><b>Поиск активов и
                        сканирование:</b> {pentestData.PTES_InformationGathering && pentestData.PTES_InformationGathering.asset_search_and_scanning}</p>
                    <p><b>Анализ портов и
                        служб:</b> {pentestData.PTES_InformationGathering && pentestData.PTES_InformationGathering.port_and_service_analysis}</p>
                    <p><b>Доступная публичная
                        документация:</b> {pentestData.PTES_InformationGathering && pentestData.PTES_InformationGathering.publicly_available_documentation}</p>

                    <h2 className={"project_h2"}>Уязвимости и анализ</h2>
                    <p><b>ID:</b> {pentestData && pentestData.PTES_VulnerabilityAnalysis && pentestData.PTES_VulnerabilityAnalysis.id}</p>
                    <p><b>Поиск
                        уязвимостей:</b> {pentestData && pentestData.PTES_VulnerabilityAnalysis && pentestData.PTES_VulnerabilityAnalysis.vulnerability_search}</p>
                    <p><b>Попытки
                        эксплуатации:</b> {pentestData && pentestData.PTES_VulnerabilityAnalysis && pentestData.PTES_VulnerabilityAnalysis.exploitation_attempts}</p>
                    <p><b>Оценка реакции
                        системы:</b> {pentestData && pentestData.PTES_VulnerabilityAnalysis && pentestData.PTES_VulnerabilityAnalysis.system_reaction_evaluation}</p>

                    <h2 className={"project_h2"}>Поддержание доступа</h2>
                    <p><b>ID:</b> {pentestData && pentestData.PTES_AccessMaintenance && pentestData.PTES_AccessMaintenance.id}</p>
                    <p><b>Механизмы поддержания
                        доступа:</b> {pentestData && pentestData.PTES_AccessMaintenance && pentestData.PTES_AccessMaintenance.access_maintenance_mechanisms}</p>
                    <p><b>Заслонка активности
                        атакующего:</b> {pentestData && pentestData.PTES_AccessMaintenance && pentestData.PTES_AccessMaintenance.attacker_activity_masking}</p>
                    <p><b>Мониторинг активности и доступ к
                        ресурсам:</b> {pentestData && pentestData.PTES_AccessMaintenance && pentestData.PTES_AccessMaintenance.activity_monitoring_and_access_to_resources}</p>

                    <h2 className={"project_h2"}>Анализ данных и документация</h2>
                    <p><b>ID:</b> {pentestData && pentestData.PTES_DataAnalysisAndDocumentation && pentestData.PTES_DataAnalysisAndDocumentation.id}</p>
                    <p><b>Запись шагов
                        аудита:</b> {pentestData && pentestData.PTES_DataAnalysisAndDocumentation && pentestData.PTES_DataAnalysisAndDocumentation.audit_steps_record}</p>
                    <p><b>Описание проблем и рекомендации по
                        устранению:</b> {pentestData && pentestData.PTES_DataAnalysisAndDocumentation && pentestData.PTES_DataAnalysisAndDocumentation.issue_description_and_remediation_recommendations}</p>
                    <p><b>Отчет об
                        аудите:</b> {pentestData && pentestData.PTES_DataAnalysisAndDocumentation && pentestData.PTES_DataAnalysisAndDocumentation.audit_report}</p>

                    <h2 className={"project_h2"}>Завершение аудита</h2>
                    <p><b>ID: </b>{pentestData && pentestData.PTES_AuditCompletion && pentestData.PTES_AuditCompletion.id}</p>
                    <p><b>Встреча с
                        клиентом:</b> {pentestData && pentestData.PTES_AuditCompletion && pentestData.PTES_AuditCompletion.client_meeting}</p>
                    <p><b>Доставка отчета об
                        аудите:</b> {pentestData && pentestData.PTES_AuditCompletion && pentestData.PTES_AuditCompletion.audit_report_delivery}</p>
                    <p><b>Завершение
                        проекта:</b> {pentestData && pentestData.PTES_AuditCompletion && pentestData.PTES_AuditCompletion.project_closure}</p>

                    <h2 className={"project_h2"}>Подготовка и планирование аудита</h2>
                    <p><b>ID:</b> {pentestData && pentestData.PTES_AuditPreparationAndPlanning && pentestData.PTES_AuditPreparationAndPlanning.id}</p>
                    <p><b>Цели и объем
                        аудита:</b> {pentestData && pentestData.PTES_AuditPreparationAndPlanning && pentestData.PTES_AuditPreparationAndPlanning.audit_objectives_and_scope}</p>
                    <p><b>План
                        аудита:</b> {pentestData && pentestData.PTES_AuditPreparationAndPlanning && pentestData.PTES_AuditPreparationAndPlanning.audit_plan}</p>
                    <p><b>Команда аудита и
                        роли:</b> {pentestData && pentestData.PTES_AuditPreparationAndPlanning && pentestData.PTES_AuditPreparationAndPlanning.audit_team_and_roles}</p>

                    <h2 className={"project_h2"}>Выполнение аудита и тестирование</h2>
                    <p><b>ID:</b> {pentestData && pentestData.PTES_AuditExecutionAndTesting && pentestData.PTES_AuditExecutionAndTesting.id}</p>
                    <p><b>Тестирование на
                        проникновение:</b> {pentestData && pentestData.PTES_AuditExecutionAndTesting && pentestData.PTES_AuditExecutionAndTesting.penetration_testing}</p>
                    <p><b>Сбор и анализ данных об
                        уязвимостях:</b> {pentestData && pentestData.PTES_AuditExecutionAndTesting && pentestData.PTES_AuditExecutionAndTesting.vulnerability_data_collection_and_analysis}</p>
                    <p><b>Тестирование политики
                        безопасности:</b> {pentestData && pentestData.PTES_AuditExecutionAndTesting && pentestData.PTES_AuditExecutionAndTesting.security_policy_testing}</p>

                    <h2 className={"project_h2"}>Анализ результатов и создание отчетов</h2>
                    <p><b>ID:</b> {pentestData && pentestData.PTES_ResultsAnalysisAndReporting && pentestData.PTES_ResultsAnalysisAndReporting.id}</p>
                    <p><b>Обработка
                        данных:</b> {pentestData && pentestData.PTES_ResultsAnalysisAndReporting && pentestData.PTES_ResultsAnalysisAndReporting.data_processing}</p>
                    <p><b>Оценка
                        рисков:</b>{pentestData && pentestData.PTES_ResultsAnalysisAndReporting && pentestData.PTES_ResultsAnalysisAndReporting.risk_assessment}</p>
                    <p><b>Детальный отчет об аудите с
                        рекомендациями:</b> {pentestData && pentestData.PTES_ResultsAnalysisAndReporting && pentestData.PTES_ResultsAnalysisAndReporting.detailed_audit_report_with_recommendations}</p>
                </div>
            </div>
            <button style={{fontSize: "13px"}} className={'btn btn-primary'} onClick={downloadPDF}><Trans i18nKey="btns.PDF">
                Скачать PDF
            </Trans></button>
        </div>
    );
};


export default PentestDoc;